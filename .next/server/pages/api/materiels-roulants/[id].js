"use strict";(()=>{var e={};e.id=3650,e.ids=[3650],e.modules={5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9021:e=>{e.exports=require("fs")},3873:e=>{e.exports=require("path")},6762:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},2441:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>E,routeModule:()=>A});var a={};r.r(a),r.d(a,{default:()=>m});var i=r(9947),n=r(2706),s=r(6762),o=r(8638),l=r(9021),u=r.n(l),d=r(3873),c=r.n(d);async function m(e,t){let{id:r}=e.query;if("PUT"===e.method){let{name:a,type:i,imageData:n}=e.body;if(!a||!i)return t.status(400).json({error:"Name and type are required"});try{let[e]=await o.A.query("SELECT image_data FROM materiels_roulants WHERE id = ?",[r]),s=e.length>0?e[0].image_data:null;if(n)try{let e=c().join(process.cwd(),"public","images","materiel-roulant");u().existsSync(e)||u().mkdirSync(e,{recursive:!0});let r=n.match(/^data:image\/([A-Za-z-+\/]+);base64,(.+)$/);if(!r||3!==r.length)return t.status(400).json({error:"Invalid image data"});let i=Buffer.from(r[2],"base64"),o=r[1].split("/")[1]||"png",l=`${a.toLowerCase().replace(/\s+/g,"-")}-${Date.now()}.${o}`,d=c().join(e,l);if(u().writeFileSync(d,i),s){let e=c().join(process.cwd(),"public",s);u().existsSync(e)&&u().unlinkSync(e)}s=`/images/materiel-roulant/${l}`}catch(e){return console.error("Error saving image:",e),t.status(500).json({error:"Failed to save image"})}await o.A.query("UPDATE materiels_roulants SET name = ?, type = ?, image_data = ?, updated_at = NOW() WHERE id = ?",[a,i,s,r]);let[l]=await o.A.query("SELECT * FROM materiels_roulants WHERE id = ?",[r]);t.status(200).json(l[0])}catch(e){console.error("Error updating materiel roulant:",e),t.status(500).json({error:"Failed to update materiel roulant"})}}else if("DELETE"===e.method)try{let[e]=await o.A.query("SELECT image_data FROM materiels_roulants WHERE id = ?",[r]);if(e.length>0&&e[0].image_data){let t=c().join(process.cwd(),"public",e[0].image_data);u().existsSync(t)&&u().unlinkSync(t)}await o.A.query("DELETE FROM materiels_roulants WHERE id = ?",[r]),t.status(200).json({message:"Materiel roulant deleted successfully"})}catch(e){console.error("Error deleting materiel roulant:",e),t.status(500).json({error:"Failed to delete materiel roulant"})}else t.setHeader("Allow",["PUT","DELETE"]),t.status(405).end(`Method ${e.method} Not Allowed`)}let E=(0,s.M)(a,"default"),p=(0,s.M)(a,"config"),A=new i.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/materiels-roulants/[id]",pathname:"/api/materiels-roulants/[id]",bundlePath:"",filename:""},userland:a})},8638:(e,t,r)=>{r.d(t,{A:()=>i});let a=require("mysql2/promise"),i=r.n(a)().createPool({host:process.env.MYSQL_HOST||"127.0.0.1",port:process.env.MYSQL_PORT||8889,user:process.env.MYSQL_USER||"root",password:process.env.MYSQL_PASSWORD||"root",database:process.env.MYSQL_DATABASE||"SNCF_ter_bfc",waitForConnections:!0,queueLimit:1e3})},2706:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9947:(e,t,r)=>{e.exports=r(5600)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=2441);module.exports=r})();