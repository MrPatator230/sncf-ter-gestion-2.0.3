"use strict";(()=>{var e={};e.id=2649,e.ids=[2649],e.modules={5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9021:e=>{e.exports=require("fs")},3873:e=>{e.exports=require("path")},6762:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},1329:(e,r,t)=>{t.r(r),t.d(r,{config:()=>g,default:()=>A,routeModule:()=>h});var n={};t.r(n),t.d(n,{config:()=>m,default:()=>E});var s=t(9947),i=t(2706),o=t(6762),d=t(9021),a=t.n(d),l=t(3873),u=t.n(l);let c=u().join(process.cwd(),"public","audio"),f=u().join(c,"folders.json"),p=u().join(c,"metadata.json");function y(){try{let e=a().readFileSync(f,"utf8");return JSON.parse(e).folders}catch(e){return console.error("Error reading folders:",e),[]}}function j(e){a().writeFileSync(f,JSON.stringify({folders:e},null,2))}function S(){try{let e=a().readFileSync(p,"utf8");return JSON.parse(e)}catch(e){return console.error("Error reading metadata:",e),{}}}function P(e){a().writeFileSync(p,JSON.stringify(e,null,2))}async function E(e,r){let{method:t,query:n}=e;try{switch(t){case"GET":if("folders"===n.type){let e=y();r.status(200).json({folders:e})}else{let e=n.folderId,t=S(),s=a().readdirSync(c).filter(e=>"folders.json"!==e&&"metadata.json"!==e).map(e=>{let r=e.split("-")[0],n=t[r]||{},s=a().statSync(u().join(c,e));return{id:r,name:n.name||e,url:`/audio/${e}`,folderId:n.folderId||null,size:s.size,type:n.type||"audio/mpeg",createdAt:n.createdAt||s.birthtime}}).filter(r=>{if(e){let n=t[r.id];return n&&n.folderId===e}return!t[r.id]?.folderId});r.status(200).json({files:s})}break;case"POST":if("folders"===n.type){let{name:t}=e.body;if(!t)return r.status(400).json({error:"Le nom du dossier est requis"});let n=y(),s={id:Date.now().toString(),name:t,createdAt:new Date().toISOString()};n.push(s),j(n),r.status(201).json(s)}else r.status(400).json({error:"Op\xe9ration invalide"});break;case"PUT":if("folders"===n.type&&n.id){let{name:t}=e.body,s=y(),i=s.findIndex(e=>e.id===n.id);if(-1===i)return r.status(404).json({error:"Dossier non trouv\xe9"});s[i].name=t,j(s),r.status(200).json(s[i])}else if("move"===n.type&&n.id){let{folderId:t}=e.body,s=S();s[n.id]||(s[n.id]={}),s[n.id].folderId=t,P(s),r.status(200).json({success:!0})}else if("rename"===n.type&&n.id){let{name:t}=e.body,s=S();s[n.id]||(s[n.id]={}),s[n.id].name=t,P(s),r.status(200).json({success:!0})}else r.status(400).json({error:"Op\xe9ration invalide"});break;case"DELETE":if("folders"===n.type&&n.id){let e=y().filter(e=>e.id!==n.id);j(e);let t=S();Object.keys(t).forEach(e=>{t[e].folderId===n.id&&(t[e].folderId=null)}),P(t),r.status(200).json({success:!0})}else if(n.id){let e=function(e){try{return a().readdirSync(c).find(r=>"folders.json"!==r&&"metadata.json"!==r&&r.startsWith(e))}catch(e){return console.error("Error finding file:",e),null}}(n.id);if(!e)return r.status(404).json({error:"Fichier non trouv\xe9"});let t=u().join(c,e);try{a().unlinkSync(t);let e=S();delete e[n.id],P(e),r.status(200).json({success:!0})}catch(e){console.error("Error deleting file:",e),r.status(500).json({error:"Erreur lors de la suppression du fichier: "+e.message})}}else r.status(400).json({error:"Op\xe9ration invalide"});break;default:r.setHeader("Allow",["GET","POST","PUT","DELETE"]),r.status(405).end(`Method ${t} Not Allowed`)}}catch(e){console.error("API Error:",e),r.status(500).json({error:"Erreur interne du serveur: "+e.message})}}a().existsSync(c)||a().mkdirSync(c,{recursive:!0}),a().existsSync(f)||a().writeFileSync(f,JSON.stringify({folders:[]})),a().existsSync(p)||a().writeFileSync(p,JSON.stringify({}));let m={api:{bodyParser:!0}},A=(0,o.M)(n,"default"),g=(0,o.M)(n,"config"),h=new s.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/audio-files",pathname:"/api/audio-files",bundlePath:"",filename:""},userland:n})},2706:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9947:(e,r,t)=>{e.exports=t(5600)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1329);module.exports=t})();